!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("underscore"),require("axios"));else if("function"==typeof define&&define.amd)define(["underscore","axios"],e);else{var s="object"==typeof exports?e(require("underscore"),require("axios")):e(t.underscore,t.axios);for(var r in s)("object"==typeof exports?exports:t)[r]=s[r]}}(window,(function(t,e){return function(t){var e={};function s(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(r,i,function(e){return t[e]}.bind(null,i));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=2)}([function(e,s){e.exports=t},function(t,s){t.exports=e},function(t,e,s){"use strict";s.r(e),s.d(e,"default",(function(){return h}));var r=s(0),i=s.n(r),n=s(1),o=s.n(n);var u={get:"{id}",cget:"",post:"",delete:"{id}",put:"{id}",patch:"{id}",option:"{id}",load:"",send:"",new:"new",save:"save",edit:"edit/{id}",remove:"remove/{id}"};class a{constructor(){this.root="/",this.url="",this.routing=u,this.params={}}init(t,e,s){const r=s?s+"/":"",i=e?e+"/":"";return this.root=`${t}/${i}${r}`,this}setRouting(t,e){return this.routing={route:e},i.a.extend(this.routing,u,t),this}setParams(t,e){const s=e.replace(/\{(.*?)\}/gi,(e,s)=>{const r=t[s];return delete t[s],r});return this.params=t||{},s}getUrlPath(t){let e;const{route:s}=this.routing,r=this.routing[t];return e=s||"",e&&r?e=`${e}/${r}`:r&&(e=r),e}setUrl(t,e,s){let r,{root:i}=this;return this.isAbsolute(s)?(i="",r=s):r=s||this.getUrlPath(t),r=this.setParams(e,r),this.url=i+r,this.url}isAbsolute(t){return new RegExp("(www|://)").test(t)}}class h extends class extends class{constructor(t,e){this.omitEmpty=!0===e,this.axiosInstance=o.a.create(t||{})}axios(){return this.axiosInstance}get(t,e,s){return this.request("get","get",null,t,e,s)}load(t,e,s){return this.request("get","load",null,t,e,s)}cget(t,e,s){return this.request("get","cget",null,t,e,s)}send(t,e,s){return this.request("get","send",null,t,e,s)}post(t,e,s,r){return this.request("post","post",t,e,s,r)}save(t,e,s,r){return this.request("post","save",t,e,s,r)}new(t,e,s,r){return this.request("post","new",t,e,s,r)}edit(t,e,s,r){return this.request("post","edit",t,e,s,r)}remove(t,e,s,r){return this.request("post","remove",t,e,s,r)}delete(t,e,s){return this.request("delete","delete",null,t,e,s)}put(t,e,s,r){return this.request("put","put",t,e,s,r)}patch(t,e,s,r){return this.request("patch","patch",t||{},e,s,r)}option(t,e,s){return this.request("option","option",null,t,e,s)}axiosData(t,e){return t||["post","put","patch"].includes(e)}adaptParams(t){if(!this.omitEmpty)return t;return function t(e){return e=i.a.mapObject(e,e=>i.a.isObject(e)?i.a.isEmpty(e)?null:t(e):e),i.a.pick(e,t=>""!==t&&!i.a.isNull(t)&&!i.a.isNaN(t)&&!i.a.isUndefined(t))}(t)}async request(t,e,s,r,i,n){let o=null;const u=this.router.setUrl(e,r,i);return this.config.params=this.adaptParams(this.router.params),await this.delay(n),o=this.axiosData(s,t)?this.axiosInstance[t](u,s,this.config):this.axiosInstance[t](u,this.config),o.finally(()=>{this.clear()})}async delay(t){let e=t||this.wait||0;return e<this.wait&&(e=this.wait),e?new Promise(t=>{i.a.delay(t,1e3*e)}):Promise.resolve()}}{define(t,e){this.resources[t]=e}extend(t,e){i.a.extend(this.resources[t],e)}default(t,e){return void 0!==e&&(this.defaults[t]=e),this.defaults[t]}setDelay(t){return this.wait=t||0,this}setHeaders(t){t&&(i.a.defaults(this.config,{headers:{}}),i.a.extend(this.config.headers,t))}setBaseURL(t){let e=t||this.defaults.baseURL||null;e&&(this.config.baseURL=e)}isAuth(){return this.config.headers&&this.config.headers.Authorization}saveAuthKey(t,e){this.extend(e,{key:t})}setAuthKey(t,e){let s=t||this.defaults.key;return s&&this.setHeaders({Authorization:"Bearer "+s}),e&&this.saveAuthKey(s,e),this}setAxiosConfig(t){i.a.extend(this.config,t)}dumpAxiosConfig(){return this.config}}{constructor(t,e,s){super(e,s),this.resources=t||[],this.defaults={},this.config={},this.lastConfig={},this.router=new a}clear(){this.lastConfig=Object.assign({},this.config),this.config={}}res(t,e){return this.setApi(e||t),this.setResource(t)}getConfig(t){const e=this.resources[t]||{},s=Object.assign({},e);return i.a.defaults(s,this.resources.default)}setApi(t){let e=this.getConfig(t);this.router.init(e.host,e.prefix,e.version),this.setDelay(e.delay),this.isAuth()||this.setAuthKey(e.key)}setResource(t){let e=this.getConfig(t);return this.router.setRouting(e.routing||{},t),this}baseURL(){return this.root}lastURL(){return this.router.url}lastAxiosConfig(){return this.lastConfig}}}])}));